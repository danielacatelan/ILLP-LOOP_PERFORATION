// COVARIANCE
#include <stdio.h>
#include <stdlib.h>
#include <enerc.h>

unsigned long read_cycles(void)
{
  unsigned long cycles;
  asm volatile ("rdcycle %0" : "=r" (cycles));
  return cycles;
}


float mean(float arr[], int n)
{
	float sum = 0;
	for (int i = 0; i < n; i++)
		sum = sum + arr[i];
	return sum / n;
}


float covariance(float arr1[], float arr2[], int n)
{
	float sum = 0;
	float mean_arr1 = mean(arr1, n);
	float mean_arr2 = mean(arr2, n);
	for (int i = 0; i < n; i++)//LOOP PERFORATION
		sum = sum + (arr1[i] - mean_arr1) * (arr2[i] - mean_arr2);
	return sum / (n - 1);
}


int main()
{
	
	float arr1[] = { 384,   47,  333,  556,  738,  767,  942,  772,  993,  770,  941,  167,  425,  729,  816,  957,  711,  647,  590,  415,  161,  807,  517,  274,  409,  332,  871,  890,  662,  871,  669,  910,  385,  615,  778,   480,  405,  209,  261,  852,  628,  322,  891,  415,  902,  452,  858,  566,  944,   68,  395,  537,  625,  152,  402,  610,  262,  482,  268,  564,  923,  805,  428,  781,  648,  630,  218,  590,  978,  332,  902,  702,  897,  925,  695,   68,  378,  212,  785,  709,  200,  984,  990,  271,   44,  634,  938,  872,  685,  476,  183,  991,  366,   30,  137,  185,  710,  494,  341,  744,  453,  535,  824,  956,  369,  739,  156,  193,  143,  824,  890,  301,  911,  149,  709,  931,  471,  694,  364,  943,   18,  468,  925,  225,  567,  833,  442,  345,  774,  540,   95,  973,  528,  623,  553,  504,  153,  352,  554,  124,  159,   43,  455,  938,   86,  633,  409,  363,  837,  533,  551,  419,  786,  572,   80,  877,  691,  740,  821,  370,  273,  220,   85,   81,  870,  317,  575,  712,  908,  281,  600,  221,  285,  731,  834,  655,  337,  526,  167,  483,  352,  116,  133,   58,   54,  237,  243,  471,  248,  336,  817,  983,  491,  360,    333,  954,  162,  203,  574,  348,  781,  102,  385,  209,  869,   93,  709,   86,  496,  855,  914,  114,  688,  121,  690,  114,  426,  771,   81,  639,  967,  526,  789,  242,  742,   67,  844,  421,  149,  727,  825,  902,  336,  339,  215,  258,  294,  659,  248,   68,   64,  390,  236,  142,  472,  699,  164,  753,  123,  542,  784,  813,  999,  570,  153,  294,  446,  567,  384,   65,  269,  698,  690,  988,  312,  329,  521,  381,  887,  736,  499,  656,  766,  863,  672,  296,  307,  573,  820,  793,  700,  110,  417,  242,  254,  454,  253,  253,  465,  596,  151,   1000,  928,  179,  768,  530,  224,   73,  686,  105,  728,  774,  308,  445,  298,  201,  425,  162,  623,  735,  99,  986,  962,  291,  422,  134,  410,  463,  622,  940,  231,  625,  946,  704,  228,  951,   74,  704,  473,  865,  742,  376,  432,  473,  648,  268,  846,  105,  926,  589,  134,  115,  515,  944,  372,  122,  608,  939,  301,  900,  128,  346,  694,  657,  750,  954,  140,  632,  547,  264,   32,  588,  678,  620,  451,  922,  754,  370,  488,  121,  759,  547,  376,  611,  916,   98,  286,  596,  730,  282,  610,  734,  132,  593,  996,  304,  507,  128,  986,  458,  417,  384,  145,  282,   18,  257,  880,  212,  470,  686,  534,  520,  391,  841,  113,  138,  787,  452,  828,  345,  691,   68,  562,  761,  329,  378,  401,  783,  522,  440,  237,  518,  775,  331,  574,  860,  820,  503,  186,  743,  286,   45,  378,  902,  882,  331,  996,  785,  696,  443,  315,  701,  115,  343,  302,  175,  666,   76,  666,   25,  188,  500,  738,   63,  189,  777,   97,  755,  595,  279,  232,  955,  167,  273,  449,  909,  137,  582,  779,  974,   29,  397,  876,  568,   11,  107,  186,  653,  451,  115,  496,  973,  435,  116,  774,  720,  467,  713,  638,  230,  933,  919,   58,  163,  677,  173,  750,  700,  623,  899 };
	int n = sizeof(arr1) / sizeof(arr1[0]);
	
	float arr2[] = { 1,  86,  520,   890,  218,  142,  312,  201,  471,   87,  347,  331,  102,  798,   86,  102,  343,  139,  479,  830,   83,  728,  465,  330,  883,  798,  304,  281,  365,  714,  128,  453,  756,  951,  765,  577,  922,  698,  494,  934,  571,   20,  958,  777,  273,  295,  951,  146,  903,   45,  792,  370,  729,  196,  891,  705,  240,  357,  980,  119,  171,  711,  263,  59,  525,  100,   33,  58,  358,  131,  344,  663,  622,  894,  880,  481,  87,   100,  519,  523,   26,   87,  521,  543,  695,   19,  744,  662,  980,  949,  535,  995,  365,  893,  242,  121,  515,  328,  506,  199,  298,  101,  381,  712,   82,  817,  198,  745,   53,  423,  452,  583,  793,  784,  879,  963,  670,  921,  369,  210,  341,  749,  703,  725,  985,   77,  163,  660,  412,  985,  112,  279,  419,   17,  645,  553,  536,  772,  552,  671,  448,  991,  906,  274,  198,  205,  529,  543,  319,   78,  547,  461,  231,  681,  104,  454,  488,  711,  213,   32,  489,  852,  540,  903,  181,  359,  505,  513,  419, 100,  375,  760,  687,  436,  138,  646,   89,  965,  307,  513,  807,  252,  536,  104,  560,  313,  70,   22,  798,  154,  176,  646,  697,  346,  506,  552,  362,  524,  505,  847,  538,  372,  541,  509,  17,  599,  176,  132,  705,  805,  840,  730,  866,  754,  194,  518,  266,  181,  972,  950,  676,  737,  751,  233,    8,  363,  475,  236,  170,  810,  655,   44,  502,  667,  145,  117,  147,  722,  956,  920,  952,  970,  371,  371,  811,  100,  269,  502,  439,  259,  427,  914,  959,   28,  671,  581,  137,  193,  865,  654,   28,   94, 163,   83,  673,  964,  403,  383,  320,  363,  270,  774,  343,  108,  148,  790,  655,  969,  553,  206,  955,  360,  590,  647,  294,  692,  547,  708,  273,  789,  751,  669,   24,  321,   36,  248,  855,   90,  406,  858,  627,  708,  635,  452,   40,  601,  767,  476,  322,  175,  627,   44,  238,  643,  299,  914,  387,  470,  603,  138,  240,  170,  100,  258,  655,  129,  379,  867,  343,  424,  691,  880,  195,  616,  133,  567,  236,  697,  764,   42,  607,  880,  822,  152,  583,  143,    1,  376,  146,  439,   75,  957,  756,  815,  785,  964,  201,  214,  580,  868,  523,  792,  313,  753,  406,  248,  856,  878,   69,  148,  650,  915,   61,  723,  858,  305,  181,  758,  718,  381,  661,  106,  117,  431,  926,   72,  843,  197,  779,  316,  641,  697,  135,   51,   57,  909,  953,  882,  892,   28,  883,  778,   47,  303,  439,  255,  824,  448,  167,  106,  171,  776,  813,  182,  292, 980,   24,  350,  504,  627,  364,  327,  452,  769,  849,  261,  290,  267,  402,  512,  826,  637,  568,  990,  594,  578,  492,  738,  186,  918,  509,  770,  870,  984,  743,  906,  511,  196,  771,  604, 289,   20,  239,  970,  521,  770,  840,   81,    1,  965,  794,  357,  851,  799,  505,  681,   37,   10,  302,  890,  263,  622,  862,  605,  120,  413,  145,  253,  622,   42,  933,   14,  286,  473,   23,  984,  444,  694,  687,  722,  456,  545,   25,  212,   31,  283,  414,  111,  171,   72 };
	int m = sizeof(arr2) / sizeof(arr2[0]);

	unsigned long long begin, end;
        begin = read_cycles();
	if (m == n)
		printf("%.03f", covariance(arr1, arr2, m));
	end = read_cycles();
        printf("\n===============\n");
        printf("begin: %u\n", abs(begin));
        printf("end: %u\n", abs(end));
        printf("total: %u\n", abs(end) - abs(begin));
        printf("===============\n");
	return 0;
}



